---
title: Compositional analysis
author: ~
date: '2020-07-03'
slug: compositional-analysis
categories: []
tags: []
---



<pre class="r"><code>#library(robustbase)
#library(energy)
#library(gtools)
library(compositions)</code></pre>
<pre><code>## Warning: package &#39;compositions&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: tensorA</code></pre>
<pre><code>## 
## Attaching package: &#39;tensorA&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     norm</code></pre>
<pre><code>## Loading required package: robustbase</code></pre>
<pre><code>## Warning: package &#39;robustbase&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: bayesm</code></pre>
<pre><code>## Warning: package &#39;bayesm&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Welcome to compositions, a package for compositional data analysis.
## Find an intro with &quot;? compositions&quot;</code></pre>
<pre><code>## 
## Attaching package: &#39;compositions&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cor, cov, dist, var</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     %*%, scale, scale.default</code></pre>
<pre class="r"><code>library(readr)
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ------------------------------------------------------------------------------------------------------------------------------------ tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v dplyr   0.8.5
## v tibble  3.0.1     v stringr 1.4.0
## v tidyr   1.0.3     v forcats 0.5.0
## v purrr   0.3.4</code></pre>
<pre><code>## -- Conflicts --------------------------------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(neuralnet)</code></pre>
<pre><code>## 
## Attaching package: &#39;neuralnet&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     compute</code></pre>
<pre class="r"><code>library(caret)</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## 
## Attaching package: &#39;caret&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     lift</code></pre>
<pre><code>## The following object is masked from &#39;package:compositions&#39;:
## 
##     R2</code></pre>
<pre class="r"><code>library(caretEnsemble)</code></pre>
<pre><code>## 
## Attaching package: &#39;caretEnsemble&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     autoplot</code></pre>
<pre class="r"><code>library(httr)</code></pre>
<pre><code>## 
## Attaching package: &#39;httr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:caret&#39;:
## 
##     progress</code></pre>
<pre class="r"><code>library(readxl)</code></pre>
<pre class="r"><code>divide01 &lt;- function(x){
  return(x/100)
}
head(data)</code></pre>
<pre><code>##                                                                             
## 1 function (..., list = character(), package = NULL, lib.loc = NULL,        
## 2     verbose = getOption(&quot;verbose&quot;), envir = .GlobalEnv, overwrite = TRUE) 
## 3 {                                                                         
## 4     fileExt &lt;- function(x) {                                              
## 5         db &lt;- grepl(&quot;\\\\.[^.]+\\\\.(gz|bz2|xz)$&quot;, x)                     
## 6         ans &lt;- sub(&quot;.*\\\\.&quot;, &quot;&quot;, x)</code></pre>
<pre class="r"><code>data &lt;- read.csv(&quot;hardness.csv&quot;) %&gt;% 
  mutate(Al=divide01(Al),
         Co=divide01(Co),
         Cr=divide01(Cr),
         Cu=divide01(Cu),
         Fe=divide01(Fe),
         Ni=divide01(Ni))
data_ordered &lt;- read.csv(&quot;hardness.csv&quot;) %&gt;% 
  mutate(Al=divide01(Al),
         Co=divide01(Co),
         Cr=divide01(Cr),
         Cu=divide01(Cu),
         Fe=divide01(Fe),
         Ni=divide01(Ni)) %&gt;% 
  arrange(desc(hardness))

closed &lt;- clo(data, parts = 1:6,total=100)
cx &lt;- acomp(data, c(&quot;Al&quot;,&quot;Co&quot;,&quot;Cr&quot;))
plot(cx)</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>xc &lt;- acomp(data, c(&quot;Al&quot;,&quot;Co&quot;,&quot;Cr&quot;,&quot;Cu&quot;,&quot;Fe&quot;,&quot;Ni&quot;))
xc_ordered &lt;- acomp(data_ordered, c(&quot;Al&quot;,&quot;Co&quot;,&quot;Cr&quot;,&quot;Cu&quot;,&quot;Fe&quot;,&quot;Ni&quot;))
plot(xc)</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>barplot.acomp(xc)</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<p>Order of hardness desc</p>
<pre class="r"><code>barplot.acomp(xc_ordered)</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Possibly drop copper and nickel</p>
<pre class="r"><code>dd &lt;-
  read.table(text = content(GET(&quot;https://gist.githubusercontent.com/MrFlick/c1183c911bc5398105d4/raw/715868fba2d0d17a61a8081de17c468bbc525ab1/elements.txt&quot;)),
  sep = &quot;,&quot;,
  header = TRUE) %&gt;%
  mutate(
    ElementName = ifelse(ElementName == &quot;Sulfer&quot;, &quot;Sulfur&quot;, ElementName),
    ElementName = ifelse(ElementName == &quot;Phosphorous&quot;, &quot;Phosphorus&quot;, ElementName),
    ElementName = ifelse(ElementName == &quot;Flourine&quot;, &quot;Fluorine&quot;, ElementName))

data &lt;- read_excel(&quot;melting_points.xlsx&quot;, sheet = 2)

colnames(dd) &lt;- c(colnames(dd)[1:7], &quot;element&quot;, colnames(dd)[9:13])

dd %&gt;%
  left_join(data, by = &quot;element&quot;) %&gt;%
  ggplot(aes(Column,-Row)) +
  geom_tile(aes(fill = crystal_structure), color = &quot;black&quot;) +
  geom_text(aes(label = symbol)) +
  theme_void() +
  labs(fill = &quot;Crystal Structure&quot;) +
  annotate(
    &quot;text&quot;,
    x = 7,
    y = 0.2,
    label = &quot;Periodic Table of the elements&quot;,
    size = 5)</code></pre>
<pre><code>## Warning: Removed 17 rows containing missing values (geom_text).</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>dd %&gt;%
  left_join(data, by = &quot;element&quot;) %&gt;%
  mutate(
    log_cte = log(CTE),
    new_cte = CTE * 1000000,
    is_extreme = ifelse(new_cte &lt; 10, 0, 1)
  ) %&gt;%
  ggplot(aes(Column,-Row)) +
  geom_tile(aes(fill = log10(CTE)), color = &quot;black&quot;, size = 1) +
  geom_text(aes(label = symbol), colour = &quot;white&quot;) +
  geom_text(aes(label = new_cte), colour = &quot;black&quot;, nudge_y = -0.3) +
  scale_fill_gradient(low = &quot;red&quot;, high = &quot;green&quot;) +
  theme_void() +
  labs(fill = expression(paste(&quot;CTE&quot;, 10 ^ 6))) +
  annotate(
    &quot;text&quot;,
    x = 7,
    y = 0.2,
    label = &quot;Periodic Table of the elements&quot;,
    size = 5)</code></pre>
<pre><code>## Warning: Removed 17 rows containing missing values (geom_text).</code></pre>
<pre><code>## Warning: Removed 54 rows containing missing values (geom_text).</code></pre>
<p><img src="/post/2020-07-03-compositional-analysis_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
