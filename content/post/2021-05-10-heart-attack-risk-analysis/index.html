---
title: Heart attack risk analysis
author: ''
date: '2021-05-10'
slug: heart-attack-risk-analysis
categories: []
tags: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(tidyverse)
library(readr)
library(broom)
theme_set(theme_minimal())

heart &lt;- read_csv(&quot;heart.csv&quot;)</code></pre>
<p>The dataset can be found on <a href="https://www.kaggle.com/rashikrahmanpritom/heart-attack-analysis-prediction-dataset">kaggle</a></p>
<pre class="r"><code>glimpse(heart)</code></pre>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5~
## $ sex      &lt;dbl&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1~
## $ cp       &lt;dbl&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0~
## $ trtbps   &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1~
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2~
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0~
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1~
## $ thalachh &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1~
## $ exng     &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0~
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0~
## $ slp      &lt;dbl&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1~
## $ caa      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0~
## $ thall    &lt;dbl&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3~
## $ output   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</code></pre>
<p>N = 303</p>
<div id="explanation-of-features" class="section level1">
<h1>Explanation of features</h1>
<ol style="list-style-type: decimal">
<li>age - age in years</li>
<li>sex - sex (1 = male; 0 = female)</li>
<li>cp - chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 0 = asymptomatic)</li>
<li>trestbps - resting blood pressure (in mm Hg on admission to the hospital)</li>
<li>chol - serum cholestoral in mg/dl</li>
<li>fbs - fasting blood sugar &gt; 120 mg/dl (1 = true; 0 = false)</li>
<li>restecg - resting electrocardiographic results (1 = normal; 2 = having ST-T wave abnormality; 0 = hypertrophy)</li>
<li>thalach - maximum heart rate achieved</li>
<li>exang - exercise induced angina (1 = yes; 0 = no)</li>
<li>oldpeak - ST depression induced by exercise relative to rest</li>
<li>slope - the slope of the peak exercise ST segment (2 = upsloping; 1 = flat; 0 = downsloping)</li>
<li>ca - number of major vessels (0-3) colored by flourosopy</li>
<li>thal - 2 = normal; 1 = fixed defect; 3 = reversable defect</li>
<li>output - diagnosis of heart disease</li>
</ol>
<p>It is my understanding that the ST is a specific interval of time during an electrocardiogram stress test.</p>
</div>
<div id="exploring-the-dataset" class="section level1">
<h1>Exploring the dataset</h1>
<pre class="r"><code>heart %&gt;% 
  count(output)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   output     n
## *  &lt;dbl&gt; &lt;int&gt;
## 1      0   138
## 2      1   165</code></pre>
<p>The dataset represents 54.46% of people who suffer with heart disease.</p>
<div id="covariance-matrix" class="section level2">
<h2>Covariance matrix</h2>
<pre class="r"><code>g &lt;- cor(heart)

corrplot::corrplot(g)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The covariance matrix above shows heart disease to be positively correlated with chest pain, the maximum heart rate achieved, and the incline type of exercise during the testing segment; and negatively correlated with exercise induced angina, and ST depression induced by exercise. I expect any machine learning model to take these correlations into account.</p>
</div>
<div id="age-distribution" class="section level2">
<h2>Age distribution</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(age)) +
  geom_histogram(alpha = 0.5, fill = &quot;dodgerblue&quot;,binwidth = 5)+
  geom_vline(xintercept = mean(heart$age),lty = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(age))+
  geom_density()+
  geom_vline(xintercept = mean(heart$age),lty = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The observations within the dataset tends to skew older ages.</p>
</div>
<div id="sex-distribution" class="section level2">
<h2>Sex distribution</h2>
<pre class="r"><code>heart %&gt;% 
  count(sex)</code></pre>
<pre><code>## # A tibble: 2 x 2
##     sex     n
## * &lt;dbl&gt; &lt;int&gt;
## 1     0    96
## 2     1   207</code></pre>
<p>There are ~twice the amount of men featured in the dataset than women.</p>
</div>
<div id="chest-pain-distribution" class="section level2">
<h2>Chest pain distribution</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(cp))+
  geom_histogram(fill = &quot;dodgerblue&quot;)+
  ggtitle(&quot;Chest pain&quot;, subtitle = &quot;chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 0 = asymptomatic)&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="resting-blood-pressure" class="section level2">
<h2>Resting blood pressure</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(trtbps))+
  geom_histogram(fill = &quot;dodgerblue&quot;)+
  ggtitle(&quot;Resting blood pressure&quot;, subtitle = &quot;resting blood pressure (in mm Hg on admission to the hospital)&quot;)+
  geom_errorbarh(aes(xmin = 90, xmax = 120, y = 20),height = 4)+
  annotate(&quot;text&quot;,label = &quot;NHS &#39;normal&#39; range&quot;, x = 105, y = 22)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="672" />
There are a few observations with very high outlier resting blood pressure. According to the <a href="https://www.nhs.uk/common-health-questions/lifestyle/what-is-blood-pressure/">NHS</a>, a normal range for resting blood pressure in between 90 and 120.</p>
<pre class="r"><code>heart %&gt;% 
  filter(trtbps&gt;120) %&gt;% 
  count()</code></pre>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   206</code></pre>
<p>The dataset skews heavily 67.99% outside of the ‘normal’ range for resting blood pressure.</p>
</div>
<div id="cholestoral-levels" class="section level2">
<h2>Cholestoral levels</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(chol)) +
  geom_histogram(fill = &quot;dodgerblue&quot;) +
  ggtitle(&quot;Cholestoral levels&quot;,subtitle = &quot;serum cholestoral in mg/dl&quot;)+
  geom_errorbarh(aes(xmin = 125, xmax = 200, y = 20),height = 2) +
  annotate(&quot;text&quot;,label = &quot;&#39;normal&#39; range&quot;, x = 162.5, y = 22)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" />
The normal range for cholesterol levels according to <a href="https://www.medicinenet.com/what_is_the_normal_range_for_cholesterol_levels/article.htm">medicinenet.com</a> is 125 to 200 mg/dL for men and women over age 20. Most of the observations fall outside of this range. There are very high outliers within the dataset with levels above 400 mg/dL.</p>
</div>
</div>
<div id="fitting-a-model-with-predictive-power" class="section level1">
<h1>Fitting a model with predictive power</h1>
<pre class="r"><code>i &lt;- sample(c(rep(0, 0.7 * (nrow(heart)+1)),
              rep(1, 0.3 * (nrow(heart)+1))))


heart_train &lt;- heart[i == 0, ]       
heart_test &lt;- heart[i == 1, ]     



y &lt;- heart_train$output
#colnames(heart)[1:ncol(heart)-1]
x &lt;- data.matrix(heart_train[, c(colnames(heart)[1:ncol(heart)-1])])


library(glmnet)</code></pre>
<pre><code>## Warning: package &#39;glmnet&#39; was built under R version 4.0.4</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.1-1</code></pre>
<pre class="r"><code>heart_model &lt;- cv.glmnet(x, y, alpha = 1)

best_lambda &lt;- heart_model$lambda.min

best_lambda</code></pre>
<pre><code>## [1] 0.004003841</code></pre>
<pre class="r"><code>plot(heart_model)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>best_model &lt;- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(best_model)</code></pre>
<pre><code>## 14 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                        s0
## (Intercept)  0.7840412600
## age         -0.0003104408
## sex         -0.1840898417
## cp           0.0962981901
## trtbps      -0.0026852922
## chol        -0.0003094917
## fbs         -0.0547247385
## restecg      0.0617677011
## thalachh     0.0040221818
## exng        -0.1730814616
## oldpeak     -0.0412573727
## slp          0.0430217398
## caa         -0.0772056604
## thall       -0.1277837407</code></pre>
<p>The fbs (fasting blood sugar) coefficient has been reduced to zero because of the nature of the Lasso regression model used. The Lasso regression is often implemented when there are lots of features and over-fitting a model may become a problem in producing an accurate model. Coefficients tending to zero are dropped from the model completely.</p>
<pre class="r"><code>heart_test_x &lt;- data.matrix(heart_test[, c(colnames(heart)[1:ncol(heart)-1])])
heart_test_y &lt;- heart_test$output
predictions &lt;- predict(best_model, s = best_lambda, newx = heart_test_x)
dim(predictions)</code></pre>
<pre><code>## [1] 91  1</code></pre>
<pre class="r"><code>dim(y)</code></pre>
<pre><code>## NULL</code></pre>
<pre class="r"><code>sst &lt;- sum((y - mean(y))^2)
sse &lt;- sum((predictions - heart_test_y)^2)

#find R-Squared
rsq &lt;- 1 - sse/sst
rsq</code></pre>
<pre><code>## [1] 0.7830938</code></pre>
<p>The R-squared turns out to be 0.7831. That is, the best model was able to explain 78.31% of the variation in the response values of the training data.</p>
<pre class="r"><code>full_results &lt;- cbind(data.frame(heart_test_y),predictions, heart_test_x) %&gt;% 
  rename(&quot;prediction&quot; = &quot;1&quot;,
         &quot;output&quot; = &quot;heart_test_y&quot;)



full_results</code></pre>
<pre><code>##    output  prediction age sex cp trtbps chol fbs restecg thalachh exng oldpeak
## 1       1  0.91991803  41   0  1    130  204   0       0      172    0     1.4
## 2       1  0.61956213  54   1  0    140  239   0       1      160    0     1.2
## 3       1  0.97061378  48   0  2    130  275   0       1      139    0     0.2
## 4       1  0.62759659  64   1  3    110  211   0       0      144    1     1.8
## 5       1  0.73716756  66   0  3    150  226   0       1      114    0     2.6
## 6       1  0.49508071  59   1  0    135  234   0       1      161    0     0.5
## 7       1  0.42680789  61   1  2    150  243   1       1      137    1     1.0
## 8       1  0.70881543  59   1  2    150  212   1       1      157    0     1.6
## 9       1  0.61760715  53   1  2    130  197   1       0      152    0     1.2
## 10      1  0.85236973  44   1  1    130  219   0       0      188    0     0.0
## 11      1  0.83309432  52   1  1    120  325   0       1      172    0     0.2
## 12      1  0.88468567  44   1  2    140  235   0       0      180    0     0.0
## 13      1  0.79862161  53   0  0    138  234   0       0      160    0     0.0
## 14      1  0.94163970  51   0  2    130  256   0       0      149    0     0.5
## 15      1  1.03886479  63   0  2    135  252   0       0      172    0     0.0
## 16      1  0.77270984  58   1  2    140  211   1       0      165    0     0.0
## 17      1  0.91144222  45   0  1    130  234   0       0      175    0     0.6
## 18      1  0.91499327  62   0  0    124  209   0       1      163    0     0.0
## 19      1  0.58763207  51   1  2     94  227   0       1      154    1     0.0
## 20      1  1.07439179  43   0  2    122  213   0       1      165    0     0.2
## 21      1  0.61239508  59   1  1    140  221   0       1      164    1     0.0
## 22      1  0.70546312  52   1  3    152  298   1       1      178    0     1.2
## 23      1  0.66849366  42   0  0    102  265   0       0      122    0     0.6
## 24      1  0.68698054  46   1  1    101  197   1       1      156    0     0.0
## 25      1  1.01697536  54   0  2    110  214   0       1      158    0     1.6
## 26      1  0.65765560  58   0  0    100  248   0       0      122    0     1.0
## 27      1  0.59998769  52   1  2    138  223   0       1      169    0     0.0
## 28      1  0.92038127  45   0  1    112  160   0       1      138    0     0.0
## 29      1  0.10831442  53   1  0    142  226   0       0      111    1     0.0
## 30      1  0.28693860  52   1  0    108  233   1       1      147    0     0.1
## 31      1  0.72086346  43   1  2    130  315   0       1      162    0     1.9
## 32      1  0.59084323  53   1  2    130  246   1       0      173    0     0.0
## 33      1  0.91782203  50   1  2    129  196   0       1      163    0     0.0
## 34      1  0.54366170  69   1  3    160  234   1       0      131    0     0.1
## 35      1  0.54395402  45   0  0    138  236   0       0      152    1     0.2
## 36      1  0.54972861  46   0  0    138  243   0       0      152    1     0.0
## 37      1  0.42431115  64   0  0    130  303   0       1      122    0     2.0
## 38      1  0.93867293  54   0  2    160  201   0       1      163    0     0.0
## 39      1  0.81351313  42   1  1    120  295   0       1      162    0     0.0
## 40      1  0.60776732  62   1  1    128  208   1       0      140    0     0.0
## 41      1  0.98447416  51   0  2    120  295   0       0      157    0     0.6
## 42      1  1.12173971  42   0  2    120  209   0       1      173    0     0.0
## 43      1  0.58543570  70   1  1    156  245   0       0      143    0     0.0
## 44      1  0.87028377  42   1  2    130  180   0       1      150    0     0.0
## 45      1  0.60057776  64   1  3    170  227   0       0      155    0     0.6
## 46      1  0.79967743  66   0  2    146  278   0       0      152    0     0.0
## 47      1  0.98646555  39   0  2    138  220   0       1      152    0     0.0
## 48      1  0.96278194  47   1  2    130  253   0       1      179    0     0.0
## 49      1  0.89045946  35   1  1    122  192   0       1      174    0     0.0
## 50      1  0.61968717  56   1  1    130  221   0       0      163    0     0.0
## 51      1  0.93697707  41   1  1    120  157   0       1      182    0     0.0
## 52      0 -0.18374410  67   1  0    160  286   0       0      108    1     1.5
## 53      0  0.62797836  48   1  1    110  229   0       1      168    0     1.0
## 54      0  0.46285232  58   1  2    132  224   0       0      173    0     3.2
## 55      0  0.17366969  50   1  0    150  243   0       0      128    0     2.6
## 56      0  0.56445086  44   1  0    112  290   0       0      153    0     0.0
## 57      0  0.18954228  60   1  0    130  253   0       1      144    1     1.4
## 58      0  0.60406706  50   1  2    140  233   0       1      163    0     0.6
## 59      0 -0.13751008  58   1  0    128  216   0       0      131    1     2.2
## 60      0  0.32454579  67   1  0    125  254   1       1      163    0     0.2
## 61      0  0.62223540  65   1  0    110  248   0       0      158    0     0.6
## 62      0  0.03865634  58   1  0    150  270   0       0      111    1     0.8
## 63      0  0.52955085  57   1  2    128  229   0       0      150    0     0.4
## 64      0  0.43823589  39   1  0    118  219   0       1      140    0     1.2
## 65      0  0.18196951  56   1  0    125  249   1       0      144    1     1.2
## 66      0  0.11640873  65   1  0    135  254   0       0      127    0     2.8
## 67      0  0.08053441  48   1  0    130  256   1       0      150    1     0.0
## 68      0  0.20678931  62   1  1    120  281   0       0      103    0     1.4
## 69      0  0.21080017  35   1  0    120  198   0       1      130    1     1.6
## 70      0  0.91635438  47   1  2    108  243   0       1      152    0     0.0
## 71      0  0.25422425  60   1  0    140  293   0       0      170    0     1.2
## 72      0  0.33434353  64   1  0    145  212   0       0      132    0     2.0
## 73      0  0.24935292  69   1  2    140  254   0       0      146    0     2.0
## 74      0  0.14368721  67   1  0    100  299   0       0      125    1     0.9
## 75      0  0.51843330  63   0  0    108  269   0       1      169    1     1.8
## 76      0  0.25063904  55   0  0    180  327   0       2      117    1     3.4
## 77      0  0.48700548  49   1  2    118  149   0       0      126    0     0.8
## 78      0 -0.03842169  54   1  0    122  286   0       0      116    1     3.2
## 79      0 -0.11699190  56   1  0    130  283   1       0      103    1     1.6
## 80      0  0.10647090  58   1  0    146  218   0       1      105    0     2.0
## 81      0  0.05048191  61   1  0    138  166   0       0      125    1     3.6
## 82      0  0.07008606  61   1  0    140  207   0       0      138    1     1.9
## 83      0  0.33309150  55   0  0    128  205   0       2      130    1     2.0
## 84      0  0.45559004  61   1  0    148  203   0       1      161    0     0.0
## 85      0  0.32311187  58   1  0    114  318   0       2      140    0     4.4
## 86      0  0.24463877  58   0  0    170  225   1       0      146    1     2.8
## 87      0  0.52796350  67   1  2    152  212   0       0      150    0     0.8
## 88      0  0.43632890  44   1  0    120  169   0       1      144    1     2.8
## 89      0  0.11361788  59   1  0    164  176   1       0       90    0     1.0
## 90      0  0.07158220  68   1  0    144  193   1       1      141    0     3.4
## 91      0  0.85062453  57   0  1    130  236   0       0      174    0     0.0
##    slp caa thall
## 1    2   0     2
## 2    2   0     2
## 3    2   0     2
## 4    1   0     2
## 5    0   0     2
## 6    1   0     3
## 7    1   0     2
## 8    2   0     2
## 9    0   0     2
## 10   2   0     2
## 11   2   0     2
## 12   2   0     2
## 13   2   0     2
## 14   2   0     2
## 15   2   0     2
## 16   2   0     2
## 17   1   0     2
## 18   2   0     2
## 19   2   1     3
## 20   1   0     2
## 21   2   0     2
## 22   1   0     3
## 23   1   0     2
## 24   2   0     3
## 25   1   0     2
## 26   1   0     2
## 27   2   4     2
## 28   1   0     2
## 29   2   0     3
## 30   2   3     3
## 31   2   1     2
## 32   2   3     2
## 33   2   0     2
## 34   1   1     2
## 35   1   0     2
## 36   1   0     2
## 37   1   2     2
## 38   2   1     2
## 39   2   0     2
## 40   2   0     2
## 41   2   0     2
## 42   1   0     2
## 43   2   0     2
## 44   2   0     2
## 45   1   0     3
## 46   1   1     2
## 47   1   0     2
## 48   2   0     2
## 49   2   0     2
## 50   2   0     3
## 51   2   0     2
## 52   1   3     2
## 53   0   0     3
## 54   2   2     3
## 55   1   0     3
## 56   2   1     2
## 57   2   1     3
## 58   1   1     3
## 59   1   3     3
## 60   1   2     3
## 61   2   2     1
## 62   2   0     3
## 63   1   1     3
## 64   1   0     3
## 65   1   1     2
## 66   1   1     3
## 67   2   2     3
## 68   1   1     3
## 69   1   0     3
## 70   2   0     2
## 71   1   2     3
## 72   1   2     1
## 73   1   3     3
## 74   1   2     2
## 75   1   2     2
## 76   1   0     2
## 77   2   3     2
## 78   1   2     2
## 79   0   0     3
## 80   1   1     3
## 81   1   1     2
## 82   2   1     3
## 83   1   1     3
## 84   2   1     3
## 85   0   3     1
## 86   1   2     1
## 87   1   0     3
## 88   0   0     1
## 89   1   2     1
## 90   1   2     3
## 91   1   1     2</code></pre>
<pre class="r"><code>confusion_matrix &lt;- full_results %&gt;% 
  mutate(correct_prediction = ifelse(output == round(prediction,0),&quot;CORRECT&quot;,&quot;INCORRECT&quot;))</code></pre>
<pre class="r"><code>(cf &lt;- confusion_matrix %&gt;% 
  count(correct_prediction))</code></pre>
<pre><code>##   correct_prediction  n
## 1            CORRECT 77
## 2          INCORRECT 14</code></pre>
<p>The lasso regression is correct for 84.62% of the testing observations.</p>
</div>
