---
title: Heart attack risk analysis
author: ''
date: '2021-05-10'
slug: heart-attack-risk-analysis
categories: []
tags: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(tidyverse)
library(readr)
library(broom)
theme_set(theme_minimal())

heart &lt;- read_csv(&quot;heart.csv&quot;)</code></pre>
<p>The dataset can be found on <a href="https://www.kaggle.com/rashikrahmanpritom/heart-attack-analysis-prediction-dataset">kaggle</a></p>
<pre class="r"><code>glimpse(heart)</code></pre>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5~
## $ sex      &lt;dbl&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1~
## $ cp       &lt;dbl&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0~
## $ trtbps   &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1~
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2~
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0~
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1~
## $ thalachh &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1~
## $ exng     &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0~
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0~
## $ slp      &lt;dbl&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1~
## $ caa      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0~
## $ thall    &lt;dbl&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3~
## $ output   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</code></pre>
<p>N = 303</p>
<div id="explanation-of-features" class="section level1">
<h1>Explanation of features</h1>
<ol style="list-style-type: decimal">
<li>age - age in years</li>
<li>sex - sex (1 = male; 0 = female)</li>
<li>cp - chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 0 = asymptomatic)</li>
<li>trestbps - resting blood pressure (in mm Hg on admission to the hospital)</li>
<li>chol - serum cholestoral in mg/dl</li>
<li>fbs - fasting blood sugar &gt; 120 mg/dl (1 = true; 0 = false)</li>
<li>restecg - resting electrocardiographic results (1 = normal; 2 = having ST-T wave abnormality; 0 = hypertrophy)</li>
<li>thalach - maximum heart rate achieved</li>
<li>exang - exercise induced angina (1 = yes; 0 = no)</li>
<li>oldpeak - ST depression induced by exercise relative to rest</li>
<li>slope - the slope of the peak exercise ST segment (2 = upsloping; 1 = flat; 0 = downsloping)</li>
<li>ca - number of major vessels (0-3) colored by flourosopy</li>
<li>thal - 2 = normal; 1 = fixed defect; 3 = reversable defect</li>
<li>output - diagnosis of heart disease</li>
</ol>
<p>It is my understanding that the ST is a specific interval of time during an electrocardiogram stress test.</p>
</div>
<div id="exploring-the-dataset" class="section level1">
<h1>Exploring the dataset</h1>
<pre class="r"><code>heart %&gt;% 
  count(output)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   output     n
## *  &lt;dbl&gt; &lt;int&gt;
## 1      0   138
## 2      1   165</code></pre>
<p>The dataset represents 54.46% of people who suffer with heart disease.</p>
<div id="covariance-matrix" class="section level2">
<h2>Covariance matrix</h2>
<pre class="r"><code>g &lt;- cor(heart)

corrplot::corrplot(g)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The covariance matrix above shows heart disease to be positively correlated with chest pain, the maximum heart rate achieved, and the incline type of exercise during the testing segment; and negatively correlated with exercise induced angina, and ST depression induced by exercise. I expect any machine learning model to take these correlations into account.</p>
</div>
<div id="age-distribution" class="section level2">
<h2>Age distribution</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(age)) +
  geom_histogram(alpha = 0.5, fill = &quot;dodgerblue&quot;,binwidth = 5)+
  geom_vline(xintercept = mean(heart$age),lty = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(age))+
  geom_density()+
  geom_vline(xintercept = mean(heart$age),lty = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The observations within the dataset tends to skew older ages.</p>
</div>
<div id="sex-distribution" class="section level2">
<h2>Sex distribution</h2>
<pre class="r"><code>heart %&gt;% 
  count(sex)</code></pre>
<pre><code>## # A tibble: 2 x 2
##     sex     n
## * &lt;dbl&gt; &lt;int&gt;
## 1     0    96
## 2     1   207</code></pre>
<p>There are ~twice the amount of men featured in the dataset than women.</p>
</div>
<div id="chest-pain-distribution" class="section level2">
<h2>Chest pain distribution</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(cp))+
  geom_histogram(fill = &quot;dodgerblue&quot;)+
  ggtitle(&quot;Chest pain&quot;, subtitle = &quot;chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 0 = asymptomatic)&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="resting-blood-pressure" class="section level2">
<h2>Resting blood pressure</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(trtbps))+
  geom_histogram(fill = &quot;dodgerblue&quot;)+
  ggtitle(&quot;Resting blood pressure&quot;, subtitle = &quot;resting blood pressure (in mm Hg on admission to the hospital)&quot;)+
  geom_errorbarh(aes(xmin = 90, xmax = 120, y = 20),height = 4)+
  annotate(&quot;text&quot;,label = &quot;NHS &#39;normal&#39; range&quot;, x = 105, y = 22)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="672" />
There are a few observations with very high outlier resting blood pressure. According to the <a href="https://www.nhs.uk/common-health-questions/lifestyle/what-is-blood-pressure/">NHS</a>, a normal range for resting blood pressure in between 90 and 120.</p>
<pre class="r"><code>heart %&gt;% 
  filter(trtbps&gt;120) %&gt;% 
  count()</code></pre>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   206</code></pre>
<p>The dataset skews heavily 67.99% outside of the ‘normal’ range for resting blood pressure.</p>
</div>
<div id="cholestoral-levels" class="section level2">
<h2>Cholestoral levels</h2>
<pre class="r"><code>heart %&gt;% 
  ggplot(aes(chol)) +
  geom_histogram(fill = &quot;dodgerblue&quot;) +
  ggtitle(&quot;Cholestoral levels&quot;,subtitle = &quot;serum cholestoral in mg/dl&quot;)+
  geom_errorbarh(aes(xmin = 125, xmax = 200, y = 20),height = 2) +
  annotate(&quot;text&quot;,label = &quot;&#39;normal&#39; range&quot;, x = 162.5, y = 22)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" />
The normal range for cholesterol levels according to <a href="https://www.medicinenet.com/what_is_the_normal_range_for_cholesterol_levels/article.htm">medicinenet.com</a> is 125 to 200 mg/dL for men and women over age 20. Most of the observations fall outside of this range. There are very high outliers within the dataset with levels above 400 mg/dL.</p>
</div>
</div>
<div id="fitting-a-model-with-predictive-power" class="section level1">
<h1>Fitting a model with predictive power</h1>
<pre class="r"><code>i &lt;- sample(c(rep(0, 0.7 * (nrow(heart)+1)),
              rep(1, 0.3 * (nrow(heart)+1))))


heart_train &lt;- heart[i == 0, ]       
heart_test &lt;- heart[i == 1, ]     



y &lt;- heart_train$output
#colnames(heart)[1:ncol(heart)-1]
x &lt;- data.matrix(heart_train[, c(colnames(heart)[1:ncol(heart)-1])])


library(glmnet)</code></pre>
<pre><code>## Warning: package &#39;glmnet&#39; was built under R version 4.0.4</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.1-1</code></pre>
<pre class="r"><code>heart_model &lt;- cv.glmnet(x, y, alpha = 1)

best_lambda &lt;- heart_model$lambda.min

best_lambda</code></pre>
<pre><code>## [1] 0.01288808</code></pre>
<pre class="r"><code>plot(heart_model)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>best_model &lt;- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(best_model)</code></pre>
<pre><code>## 14 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                       s0
## (Intercept)  0.881711189
## age         -0.004014629
## sex         -0.188398770
## cp           0.121307977
## trtbps      -0.002694150
## chol         .          
## fbs          .          
## restecg      0.002778569
## thalachh     0.003878710
## exng        -0.052895529
## oldpeak     -0.039821998
## slp          0.053357529
## caa         -0.095476937
## thall       -0.128036471</code></pre>
<p>The fbs (fasting blood sugar) coefficient has been reduced to zero because of the nature of the Lasso regression model used. The Lasso regression is often implemented when there are lots of features and over-fitting a model may become a problem in producing an accurate model. Coefficients tending to zero are dropped from the model completely.</p>
<pre class="r"><code>heart_test_x &lt;- data.matrix(heart_test[, c(colnames(heart)[1:ncol(heart)-1])])
heart_test_y &lt;- heart_test$output
predictions &lt;- predict(best_model, s = best_lambda, newx = heart_test_x)
dim(predictions)</code></pre>
<pre><code>## [1] 91  1</code></pre>
<pre class="r"><code>dim(y)</code></pre>
<pre><code>## NULL</code></pre>
<pre class="r"><code>sst &lt;- sum((y - mean(y))^2)
sse &lt;- sum((predictions - heart_test_y)^2)

#find R-Squared
rsq &lt;- 1 - sse/sst
rsq</code></pre>
<pre><code>## [1] 0.7370753</code></pre>
<p>The R-squared turns out to be 0.7371. That is, the best model was able to explain 73.71% of the variation in the response values of the training data.</p>
<pre class="r"><code>full_results &lt;- cbind(data.frame(heart_test_y),predictions, heart_test_x) %&gt;% 
  rename(&quot;prediction&quot; = &quot;1&quot;,
         &quot;output&quot; = &quot;heart_test_y&quot;)



full_results</code></pre>
<pre><code>##    output   prediction age sex cp trtbps chol fbs restecg thalachh exng oldpeak
## 1       1  0.739977534  56   0  1    140  294   0       0      153    0     1.3
## 2       1  0.597598061  52   1  2    172  199   1       1      162    0     0.5
## 3       1  0.661888457  66   0  3    150  226   0       1      114    0     2.6
## 4       1  0.369327029  59   1  0    135  234   0       1      161    0     0.5
## 5       1  0.887930609  44   1  2    130  233   0       1      179    1     0.4
## 6       1  0.826618419  40   1  3    140  199   0       1      178    1     1.4
## 7       1  0.693605690  59   1  2    150  212   1       1      157    0     1.6
## 8       1  0.818460284  65   0  2    140  417   1       0      157    0     0.8
## 9       1  0.658618090  53   1  2    130  197   1       0      152    0     1.2
## 10      1  0.361538333  65   1  0    120  177   0       1      140    0     0.4
## 11      1  0.867576781  44   1  1    130  219   0       0      188    0     0.0
## 12      1  0.647079100  51   1  3    125  213   0       0      125    1     1.4
## 13      1  0.613893473  54   1  2    150  232   0       0      165    0     1.6
## 14      1  0.759166659  48   1  1    130  245   0       0      180    0     0.2
## 15      1  0.831168954  47   1  2    138  257   0       0      156    0     0.0
## 16      1  0.472089886  66   1  0    120  302   0       0      151    0     0.4
## 17      1  0.216989792  62   1  2    130  231   0       1      146    0     1.8
## 18      1  0.583765889  52   1  1    134  201   0       1      158    0     0.8
## 19      1  0.771030300  45   1  0    115  260   0       0      185    0     0.0
## 20      1  1.128366884  34   1  3    118  182   0       0      174    0     0.0
## 21      1  0.802329452  71   0  2    110  265   1       0      130    0     0.0
## 22      1  0.816528128  58   1  2    140  211   1       0      165    0     0.0
## 23      1  0.873001541  35   0  0    138  183   0       1      182    0     1.4
## 24      1  1.017293527  41   1  2    112  250   0       1      179    0     0.0
## 25      1  0.198214685  53   1  0    142  226   0       0      111    1     0.0
## 26      1  0.198725064  52   1  0    108  233   1       1      147    0     0.1
## 27      1  0.351865650  59   1  3    178  270   0       0      145    0     4.2
## 28      1  0.537674395  64   0  0    180  325   0       1      154    1     0.0
## 29      1  0.790352921  41   1  2    130  214   0       0      168    0     2.0
## 30      1  1.056019260  46   0  1    105  204   0       1      172    0     0.0
## 31      1  1.118869648  34   0  1    118  210   0       1      192    0     0.7
## 32      1  0.606974048  47   1  0    112  204   0       1      143    0     0.1
## 33      1  0.870918039  67   0  2    152  277   0       1      172    0     0.0
## 34      1  0.866646619  54   0  2    160  201   0       1      163    0     0.0
## 35      1  0.873700390  49   0  1    134  271   0       1      162    0     0.0
## 36      1  0.804479652  42   1  1    120  295   0       1      162    0     0.0
## 37      1  0.800527395  41   1  1    110  235   0       1      153    0     0.0
## 38      1  0.014479319  64   1  0    128  263   0       1      105    1     0.2
## 39      1  1.103494679  42   0  2    120  209   0       1      173    0     0.0
## 40      1  0.528448165  67   0  0    106  223   0       1      142    0     0.3
## 41      1  0.651002212  76   0  2    140  197   0       2      116    0     1.1
## 42      1  0.518606588  70   1  1    156  245   0       0      143    0     0.0
## 43      1  0.419632851  66   1  0    160  228   0       0      138    0     2.3
## 44      1  0.582904153  58   0  0    130  197   0       1      131    0     0.6
## 45      1  0.077727521  58   1  1    125  220   0       1      144    0     0.4
## 46      1  0.594397021  56   1  1    130  221   0       0      163    0     0.0
## 47      1  0.554109499  38   1  2    138  175   0       1      173    0     0.0
## 48      0  0.285830758  62   0  0    140  268   0       0      160    0     3.6
## 49      0  0.664701838  56   1  2    130  256   1       0      142    1     0.6
## 50      0  0.183596723  60   1  0    117  230   1       1      160    1     1.4
## 51      0  0.247826955  57   1  0    150  276   0       0      112    1     0.6
## 52      0  0.515538404  58   1  2    112  230   0       0      165    0     2.5
## 53      0 -0.001505520  54   1  0    124  266   0       0      109    1     2.2
## 54      0  0.448847163  51   0  0    130  305   0       1      142    1     1.2
## 55      0 -0.030936557  59   1  0    170  326   0       0      140    1     3.4
## 56      0  0.574007238  46   1  2    150  231   0       1      147    0     3.6
## 57      0  0.662009064  44   1  0    110  197   0       0      177    0     0.0
## 58      0  0.071938076  60   1  0    125  258   0       0      141    1     2.8
## 59      0  0.261006096  49   1  2    120  188   0       1      139    0     2.0
## 60      0  0.291384387  56   1  0    125  249   1       0      144    1     1.2
## 61      0  0.210933441  48   1  0    130  256   1       0      150    1     0.0
## 62      0  0.289150635  35   1  0    120  198   0       1      130    1     1.6
## 63      0  0.397785920  64   1  2    125  309   0       1      131    1     1.8
## 64      0 -0.006619491  64   1  0    120  246   0       0       96    1     2.2
## 65      0  0.318606344  58   1  0    125  300   0       0      171    0     0.0
## 66      0  0.187084018  77   1  0    125  304   0       0      162    1     0.0
## 67      0  0.488126346  35   1  0    126  282   0       0      156    1     0.0
## 68      0  0.066426268  70   1  2    160  269   0       1      112    1     2.9
## 69      0 -0.127837953  57   1  0    152  274   0       1       88    1     1.2
## 70      0  0.213452322  56   1  0    132  184   0       0      105    1     2.1
## 71      0  0.459738576  48   1  0    124  274   0       0      166    0     0.5
## 72      0  0.172809345  66   1  1    160  246   0       1      120    1     0.0
## 73      0  0.464030741  54   1  1    192  283   0       0      195    0     0.0
## 74      0  0.151202921  69   1  2    140  254   0       0      146    0     2.0
## 75      0  0.157351404  67   1  0    100  299   0       0      125    1     0.9
## 76      0  0.030176929  45   1  0    142  309   0       0      147    1     0.0
## 77      0  0.173853591  50   1  0    144  200   0       0      126    1     0.9
## 78      0  0.755115197  38   1  3    120  231   0       1      182    1     3.8
## 79      0  0.165529376  66   0  0    178  228   1       1      165    1     1.0
## 80      0 -0.133832648  53   1  0    123  282   0       1       95    1     2.0
## 81      0  0.247978740  54   1  0    110  206   0       0      108    1     0.0
## 82      0  0.434623746  46   1  0    120  249   0       0      144    0     0.8
## 83      0 -0.028711682  58   1  0    146  218   0       1      105    0     2.0
## 84      0  0.446656823  42   1  0    136  315   0       1      125    1     1.8
## 85      0  0.105072390  61   1  0    140  207   0       0      138    1     1.9
## 86      0  0.267076465  55   0  0    128  205   0       2      130    1     2.0
## 87      0  0.476634423  67   1  2    152  212   0       0      150    0     0.8
## 88      0  0.058237770  59   1  0    164  176   1       0       90    0     1.0
## 89      0  0.716451529  45   1  3    110  264   0       1      132    0     1.2
## 90      0 -0.075063845  68   1  0    144  193   1       1      141    0     3.4
## 91      0  0.036158519  57   1  0    130  131   0       1      115    1     1.2
##    slp caa thall
## 1    1   0     2
## 2    2   0     3
## 3    0   0     2
## 4    1   0     3
## 5    2   0     2
## 6    2   0     3
## 7    2   0     2
## 8    2   1     2
## 9    0   0     2
## 10   2   0     3
## 11   2   0     2
## 12   2   1     2
## 13   2   0     3
## 14   1   0     2
## 15   2   0     2
## 16   1   0     2
## 17   1   3     3
## 18   2   1     2
## 19   2   0     2
## 20   2   0     2
## 21   2   1     2
## 22   2   0     2
## 23   2   0     2
## 24   2   0     2
## 25   2   0     3
## 26   2   3     3
## 27   0   0     3
## 28   2   0     2
## 29   1   0     2
## 30   2   0     2
## 31   2   0     2
## 32   2   0     2
## 33   2   1     2
## 34   2   1     2
## 35   1   0     2
## 36   2   0     2
## 37   2   0     2
## 38   1   1     3
## 39   1   0     2
## 40   2   2     2
## 41   1   0     2
## 42   2   0     2
## 43   2   0     1
## 44   1   0     2
## 45   1   4     3
## 46   2   0     3
## 47   2   4     2
## 48   0   2     2
## 49   1   1     1
## 50   2   2     3
## 51   1   1     1
## 52   1   1     3
## 53   1   1     3
## 54   1   0     3
## 55   0   0     3
## 56   1   0     2
## 57   2   1     2
## 58   1   1     3
## 59   1   3     3
## 60   1   1     2
## 61   2   2     3
## 62   1   0     3
## 63   1   0     3
## 64   0   1     2
## 65   2   2     3
## 66   2   3     2
## 67   2   0     3
## 68   1   1     3
## 69   1   1     3
## 70   1   1     1
## 71   1   0     3
## 72   1   3     1
## 73   2   1     3
## 74   1   3     3
## 75   1   2     2
## 76   1   3     3
## 77   1   0     3
## 78   1   0     3
## 79   1   2     3
## 80   1   2     3
## 81   1   1     2
## 82   2   0     3
## 83   1   1     3
## 84   1   0     1
## 85   2   1     3
## 86   1   1     3
## 87   1   0     3
## 88   1   2     1
## 89   1   0     3
## 90   1   2     3
## 91   1   1     3</code></pre>
<pre class="r"><code>confusion_matrix &lt;- full_results %&gt;% 
  mutate(correct_prediction = ifelse(output == round(prediction,0),&quot;CORRECT&quot;,&quot;INCORRECT&quot;))</code></pre>
<pre class="r"><code>(cf &lt;- confusion_matrix %&gt;% 
  count(correct_prediction))</code></pre>
<pre><code>##   correct_prediction  n
## 1            CORRECT 75
## 2          INCORRECT 16</code></pre>
<p>The lasso regression is correct for 82.42% of the testing observations. test2</p>
</div>
