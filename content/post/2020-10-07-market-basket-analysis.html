---
title: Market Basket Analysis
author: ~
date: '2020-10-07'
slug: market-basket-analysis
categories: []
tags: []
---



<pre class="r"><code>library(tidyverse)
library(arulesViz)
library(lubridate)
library(arules)
library(RColorBrewer)</code></pre>
<p>Data sourced from Kaggle <code>https://www.kaggle.com/heeraldedhia/groceries-dataset?select=Groceries_dataset.csv</code></p>
<p>APRIORI Algorithm</p>
<pre class="r"><code>transactions &lt;- read.csv(file.path(&quot;data&quot;,&quot;basket.csv&quot;))

transactions %&gt;% 
  count(itemDescription, sort = TRUE) %&gt;% 
  head(5)</code></pre>
<pre><code>##    itemDescription    n
## 1       whole milk 2502
## 2 other vegetables 1898
## 3       rolls/buns 1716
## 4             soda 1514
## 5           yogurt 1334</code></pre>
<pre class="r"><code>transactions %&gt;% 
  count(itemDescription, sort = TRUE) %&gt;% 
  tail(5)</code></pre>
<pre><code>##           itemDescription n
## 163        toilet cleaner 5
## 164                  bags 4
## 165        baby cosmetics 3
## 166       kitchen utensil 1
## 167 preservation products 1</code></pre>
<div id="utidying-the-dataset-for-use-with-the-apriori-algorithm-in-the-arules-package." class="section level1">
<h1>Utidying the dataset for use with the APRIORI algorithm in the “arules” package.</h1>
<pre class="r"><code>basket &lt;- transactions %&gt;%
  group_by(Member_number, Date) %&gt;%
  summarise(items = str_c(itemDescription, collapse = &quot;,&quot;)) %&gt;%
  ungroup() %&gt;%
  select(items)


head(basket)</code></pre>
<pre><code>## # A tibble: 6 x 1
##   items                                        
##   &lt;chr&gt;                                        
## 1 sausage,whole milk,semi-finished bread,yogurt
## 2 whole milk,pastry,salty snack                
## 3 canned beer,misc. beverages                  
## 4 sausage,hygiene articles                     
## 5 soda,pickled vegetables                      
## 6 frankfurter,curd</code></pre>
<pre class="r"><code>basket %&gt;% 
  count(items)</code></pre>
<pre><code>## # A tibble: 9,111 x 2
##    items                                                                 n
##    &lt;chr&gt;                                                             &lt;int&gt;
##  1 abrasive cleaner,citrus fruit,whole milk,long life bakery product     1
##  2 abrasive cleaner,yogurt,frozen meals                                  1
##  3 artif. sweetener,bottled water,butter milk,butter,soda                1
##  4 artif. sweetener,curd                                                 1
##  5 artif. sweetener,herbs                                                1
##  6 artif. sweetener,salty snack                                          1
##  7 artif. sweetener,sugar                                                1
##  8 artif. sweetener,whole milk                                           1
##  9 baby cosmetics,bottled water                                          1
## 10 bags,other vegetables                                                 1
## # ... with 9,101 more rows</code></pre>
<pre class="r"><code>#write.csv(basket,file = file.path(&quot;data&quot;,&quot;basketitems.csv&quot;))

#transaction_object &lt;- read.transactions(file.path(&quot;data&quot;,&quot;basketitems.csv&quot;),sep = &quot;,&quot;)

transaction_object &lt;- as(basket, &quot;transactions&quot;)

summary(transaction_object)</code></pre>
<pre><code>## transactions as itemMatrix in sparse format with
##  14963 rows (elements/itemsets/transactions) and
##  9111 columns (items) and a density of 0.0001097574 
## 
## most frequent items:
## items=other vegetables,whole milk       items=whole milk,whole milk 
##                                48                                40 
##       items=whole milk,rolls/buns          items=sausage,whole milk 
##                                38                                37 
## items=whole milk,other vegetables                           (Other) 
##                                37                             14763 
## 
## element (itemset/transaction) length distribution:
## sizes
##     1 
## 14963 
## 
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       1       1       1       1       1       1 
## 
## includes extended item information - examples:
##                                                                    labels
## 1 items=abrasive cleaner,citrus fruit,whole milk,long life bakery product
## 2                              items=abrasive cleaner,yogurt,frozen meals
## 3            items=artif. sweetener,bottled water,butter milk,butter,soda
##   variables                                                            levels
## 1     items abrasive cleaner,citrus fruit,whole milk,long life bakery product
## 2     items                              abrasive cleaner,yogurt,frozen meals
## 3     items            artif. sweetener,bottled water,butter milk,butter,soda
## 
## includes extended transaction information - examples:
##   transactionID
## 1             1
## 2             2
## 3             3</code></pre>
<pre class="r"><code>itemFrequencyPlot(transaction_object,topN=30,type=&quot;absolute&quot;,col=brewer.pal(8,&#39;Pastel1&#39;), main=&quot;Absolute Item Frequency Plot&quot;)</code></pre>
<p><img src="/post/2020-10-07-market-basket-analysis_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>itemFrequencyPlot(transaction_object,topN=30,type=&quot;relative&quot;,col=brewer.pal(8,&#39;Pastel1&#39;), main=&quot;Absolute Item Frequency Plot&quot;)</code></pre>
<p><img src="/post/2020-10-07-market-basket-analysis_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>rules &lt;- apriori(transaction_object, parameter = list(supp=0, conf=0.01,minlen=2))</code></pre>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##        0.01    0.1    1 none FALSE            TRUE       5       0      2
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 0 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[9111 item(s), 14963 transaction(s)] done [0.01s].
## sorting and recoding items ... [9111 item(s)] done [0.00s].
## creating transaction tree ... done [0.00s].
## checking subsets of size 1 done [0.00s].
## writing ... [0 rule(s)] done [0.00s].
## creating S4 object  ... done [0.00s].</code></pre>
<pre class="r"><code>transaction_object</code></pre>
<pre><code>## transactions in sparse format with
##  14963 transactions (rows) and
##  9111 items (columns)</code></pre>
<pre class="r"><code>summary(rules)</code></pre>
<pre><code>## set of 0 rules</code></pre>
</div>
