---
title: Time-series and yfinance api
author: ~
date: '2020-07-07'
slug: time-series-and-yfinance-api
categories: []
tags: []
---

Python integration using the reticulate package.

yFinance api from https://pypi.org/project/yfinance/

Python exchange rate api from www.exchangerate-api.com

```{r setup, include=FALSE, message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
```


```{r}
library(reticulate)
```



```{python}
import yfinance as yf
    
def yfinance01(ticker,period):
    g = yf.Ticker(ticker)
    data=g.history(period=period)
    return data

```



```{r}
library(tidyquant)
library(timetk)
library(sweep)
library(forecast)
library(tidyverse)
library(bbplot)
library(lubridate)



fixcol01 <- function(g){
  g <- cbind(date = rownames(g), g)
  rownames(g) <- 1:nrow(g)
  return(g)
}


retrieve01 <- function(ticker,period="max"){
  g <- py$yfinance01(ticker,period)
  g <- fixcol01(g)
  g <- g %>% 
    select(date, Close)%>% 
    mutate(date=as_date(ymd(date)))
  
  colnames(g) <- c("date", ticker)

  return(g)
}




  

plotting01 <- function(ticker, period="max"){
  g <- retrieve01(ticker, period)
  plot <- g %>%  
    ggplot(aes(date, get(ticker), group=1))+
    geom_point(shape=".")+
    labs(title=ticker)+
    theme_void()+
    scale_y_continuous()+
    theme(axis.text = element_text())+
    geom_line(size=1)
  return(plot)
}



multiplot <- function(..., period = "1mo"){
  x <- list(...)
  
  y <- data.frame("date"=c(seq(today()-1000,by="day",length.out = 1000)))
  for (val in x){
    
    y <- left_join(y,retrieve01(val, period),by="date")
  }
  
  h <- y %>%
    pivot_longer(cols = c(...),names_to = "ticker",values_to = "price")
    
  
  return(h)
}



multiplot("WMT","MRW.L","TSCO.L","MKS.L", period = "max") %>% 
  filter(!is.na(price)) %>% 
  mutate(price=log(price)) %>% 
  
  ggplot(aes(date, price, colour=ticker))+
  geom_line()+
  theme_void()





```


