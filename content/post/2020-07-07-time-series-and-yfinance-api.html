---
title: Time-series and yfinance api
author: ~
date: '2020-07-07'
slug: time-series-and-yfinance-api
categories: []
tags: []
---



<p>Python integration using the reticulate package.</p>
<pre class="r"><code>library(reticulate)</code></pre>
<pre><code>## Warning: package &#39;reticulate&#39; was built under R version 4.0.2</code></pre>
<pre class="python"><code>import yfinance as yf
    
def yfinance01(ticker,period):
    g = yf.Ticker(ticker)
    data=g.history(period=period)
    return data</code></pre>
<pre class="r"><code>library(tidyquant)</code></pre>
<pre><code>## Warning: package &#39;tidyquant&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: lubridate</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre><code>## Loading required package: PerformanceAnalytics</code></pre>
<pre><code>## Warning: package &#39;PerformanceAnalytics&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: xts</code></pre>
<pre><code>## Warning: package &#39;xts&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## Warning: package &#39;zoo&#39; was built under R version 4.0.2</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;PerformanceAnalytics&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     legend</code></pre>
<pre><code>## Loading required package: quantmod</code></pre>
<pre><code>## Warning: package &#39;quantmod&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: TTR</code></pre>
<pre><code>## Warning: package &#39;TTR&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<pre><code>## Version 0.4-0 included new data defaults. See ?getSymbols.</code></pre>
<pre><code>## == Need to Learn tidyquant? =======================================================
## Business Science offers a 1-hour course - Learning Lab #9: Performance Analysis &amp; Portfolio Optimization with tidyquant!
## &lt;/&gt; Learn more at: https://university.business-science.io/p/learning-labs-pro &lt;/&gt;</code></pre>
<pre class="r"><code>library(timetk)</code></pre>
<pre><code>## Warning: package &#39;timetk&#39; was built under R version 4.0.2</code></pre>
<pre class="r"><code>library(sweep)</code></pre>
<pre><code>## Warning: package &#39;sweep&#39; was built under R version 4.0.2</code></pre>
<pre class="r"><code>library(forecast)</code></pre>
<pre><code>## Warning: package &#39;forecast&#39; was built under R version 4.0.2</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ------------------------------------------ tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.4
## v tibble  3.0.1     v dplyr   0.8.5
## v tidyr   1.0.3     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts --------------------------------------------- tidyverse_conflicts() --
## x lubridate::as.difftime() masks base::as.difftime()
## x lubridate::date()        masks base::date()
## x dplyr::filter()          masks stats::filter()
## x dplyr::first()           masks xts::first()
## x lubridate::intersect()   masks base::intersect()
## x dplyr::lag()             masks stats::lag()
## x dplyr::last()            masks xts::last()
## x lubridate::setdiff()     masks base::setdiff()
## x lubridate::union()       masks base::union()</code></pre>
<pre class="r"><code>library(bbplot)
library(lubridate)



fixcol01 &lt;- function(g){
  g &lt;- cbind(date = rownames(g), g)
  rownames(g) &lt;- 1:nrow(g)
  return(g)
}


retrieve01 &lt;- function(ticker,period=&quot;max&quot;){
  g &lt;- py$yfinance01(ticker,period)
  g &lt;- fixcol01(g)
  g &lt;- g %&gt;% 
    select(date, Close)%&gt;% 
    mutate(date=as_date(ymd(date)))
  
  colnames(g) &lt;- c(&quot;date&quot;, ticker)

  return(g)
}




  

plotting01 &lt;- function(ticker, period=&quot;max&quot;){
  g &lt;- retrieve01(ticker, period)
  plot &lt;- g %&gt;%  
    ggplot(aes(date, get(ticker), group=1))+
    geom_point(shape=&quot;.&quot;)+
    labs(title=ticker)+
    theme_void()+
    scale_y_continuous()+
    theme(axis.text = element_text())+
    geom_line(size=1)
  return(plot)
}



multiplot &lt;- function(..., period = &quot;1mo&quot;){
  x &lt;- list(...)
  #c(seq(today()-30,by=&quot;day&quot;,length.out = 30))
  y &lt;- data.frame(&quot;date&quot;=c(seq(today()-1000,by=&quot;day&quot;,length.out = 1000)))
  for (val in x){
    #y &lt;- merge(y,retrieve01(val, period),by=&quot;date&quot;,all=T)
    y &lt;- left_join(y,retrieve01(val, period),by=&quot;date&quot;)
  }
  
  h &lt;- y %&gt;%
    pivot_longer(cols = c(...),names_to = &quot;ticker&quot;,values_to = &quot;price&quot;)
    
  
  return(h)
}



multiplot(&quot;WMT&quot;,&quot;GOOG&quot;,&quot;TSCO&quot;, period = &quot;max&quot;) %&gt;% 
  filter(!is.na(price)) %&gt;% 
  mutate(price=log(price)) %&gt;% 
  ggplot(aes(date, price, colour=ticker))+
  geom_line()+
  theme_bw()</code></pre>
<p><img src="/post/2020-07-07-time-series-and-yfinance-api_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
