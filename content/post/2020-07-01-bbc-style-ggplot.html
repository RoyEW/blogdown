---
title: BBC style ggplot
author: ~
date: '2020-07-01'
slug: bbc-style-ggplot
categories: []
tags: []
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE)</code></pre>
<pre class="r"><code>library(tidyverse)
#setwd(&quot;~/University/R/election2019&quot;)
library(readr)
election &lt;- read_csv(&quot;HoC-2019GE-results-by-constituency.csv&quot;) %&gt;% 
  mutate(con_p=con/valid_votes,
         lab_p=lab/valid_votes,
         brexit_p=brexit/valid_votes,
         ld_p=ld/valid_votes,
         snp_p=snp/valid_votes)</code></pre>
<div id="voting-mix-of-the-most-populated-constituencies" class="section level3">
<h3>Voting mix of the most populated constituencies</h3>
<pre class="r"><code>party_colours &lt;- c(&quot;purple&quot;, &quot;lightblue&quot;, &quot;red&quot;,&quot;orange&quot;,&quot;yellow&quot;)
election %&gt;% 
  arrange(desc(valid_votes)) %&gt;% 
  mutate(constituency_name=fct_reorder(constituency_name,con_p)) %&gt;% 
  head(30) %&gt;% 
  gather(key=&quot;Party&quot;, value=&quot;Number&quot;, con, lab, ld, snp, brexit) %&gt;% 
  ggplot(aes(constituency_name,Number,fill=Party))+
  geom_col()+
  scale_fill_manual(values=party_colours)+
  coord_flip()+
  bbc_style()</code></pre>
<pre><code>## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family not
## found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="voting-mix-of-the-least-populated-constituencies" class="section level3">
<h3>Voting mix of the least populated constituencies</h3>
<pre class="r"><code>election %&gt;% 
  arrange(valid_votes) %&gt;% 
  mutate(constituency_name=fct_reorder(constituency_name,valid_votes)) %&gt;% 
  head(30) %&gt;% 
  gather(key=&quot;Party&quot;, value=&quot;Number&quot;, con, lab, ld, snp, brexit) %&gt;% 
  ggplot(aes(constituency_name,Number,fill=Party))+
  geom_col()+
  scale_fill_manual(values=party_colours)+
  coord_flip()+
  bbc_style()</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
## family not found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="where-are-the-conservative-strongholds" class="section level3">
<h3>Where are the Conservative strongholds?</h3>
<pre class="r"><code>election %&gt;% 
  arrange(desc(con_p)) %&gt;% 
  mutate(constituency_name=fct_reorder(constituency_name,con_p)) %&gt;% 
  head(30) %&gt;%
  gather(Party, Proportion, con_p, lab_p, ld_p, brexit_p, snp_p) %&gt;% 
  ggplot(aes(constituency_name,Proportion, fill = Party))+
  geom_col()+
  scale_fill_manual(values=party_colours)+
  scale_y_continuous(label=scales::percent_format()) +
  coord_flip()+
  bbc_style()</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
## family not found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>election %&gt;% 
  mutate(constituency_name=fct_reorder(constituency_name, -con_p)) %&gt;% 
  gather(Party, Proportion, con_p, lab_p, snp_p, brexit_p, ld_p) %&gt;% 
  ggplot(aes(constituency_name, Proportion, fill = Party)) +
  geom_col()+
  scale_fill_manual(values=party_colours)+
  labs(
    x=&quot;&quot;,
    y=&quot;Vote Share&quot;
  )+
  scale_x_discrete()+
  bbc_style()</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
## family not found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Reordering by voteshare</p>
<pre class="r"><code>election %&gt;% 
  view()
election %&gt;% 
  mutate(constituency_name=fct_reorder(constituency_name, -con_p)) %&gt;% 
  arrange(con_p) %&gt;% 
  gather(Party, Proportion, con_p, lab_p, snp_p, brexit_p, ld_p) %&gt;% 
  ggplot(aes(constituency_name, Proportion, fill = Party)) +
  geom_col()+
  scale_fill_manual(values=party_colours)+
  scale_x_discrete(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  labs(
    x=&quot;&quot;,
    y=&quot;Vote Share&quot;
  )+
 bbc_style()+
  theme(axis.text.x = element_blank())</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
## family not found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>election %&gt;% 
  ggplot(aes(con_p)) +
  geom_histogram()+
  bbc_style()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
## family not found in Windows font database</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>election %&gt;% 
  ggplot(aes(lab_p))+
  geom_histogram()+
  bbc_style()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/post/2020-07-01-bbc-style-ggplot_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>election_noscotland &lt;- election %&gt;% 
  filter(!country_name==&quot;Scotland&quot;)
  
lm(brexit_p ~ con_p + lab_p + ld_p, data = election_noscotland)</code></pre>
<pre><code>## 
## Call:
## lm(formula = brexit_p ~ con_p + lab_p + ld_p, data = election_noscotland)
## 
## Coefficients:
## (Intercept)        con_p        lab_p         ld_p  
##     0.04638     -0.06509      0.04360     -0.06613</code></pre>
<pre class="r"><code>election_wales &lt;- election %&gt;% 
  filter(country_name==&quot;Wales&quot;)
#tidy(lm(brexit_p ~ con_p + lab_p + ld_p, data = election_wales))</code></pre>
</div>
