---
title: Compositional analysis
author: ~
date: '2020-07-03'
slug: compositional-analysis
categories: []
tags: []
---


```{r setup, include=FALSE, message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = T,warning = FALSE, message = FALSE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}

#library(robustbase)
#library(energy)
#library(gtools)
library(compositions)
library(readr)
library(tidyverse)
library(neuralnet)
library(caret)
library(caretEnsemble)
library(httr)
library(readxl)
```

```{r}
divide01 <- function(x){
  return(x/100)
}
head(data)
data <- read.csv("hardness.csv") %>% 
  mutate(Al=divide01(Al),
         Co=divide01(Co),
         Cr=divide01(Cr),
         Cu=divide01(Cu),
         Fe=divide01(Fe),
         Ni=divide01(Ni))
data_ordered <- read.csv("hardness.csv") %>% 
  mutate(Al=divide01(Al),
         Co=divide01(Co),
         Cr=divide01(Cr),
         Cu=divide01(Cu),
         Fe=divide01(Fe),
         Ni=divide01(Ni)) %>% 
  arrange(desc(hardness))

closed <- clo(data, parts = 1:6,total=100)
cx <- acomp(data, c("Al","Co","Cr"))
plot(cx)
xc <- acomp(data, c("Al","Co","Cr","Cu","Fe","Ni"))
xc_ordered <- acomp(data_ordered, c("Al","Co","Cr","Cu","Fe","Ni"))
plot(xc)
barplot.acomp(xc)

```

Order of hardness desc



```{r}

barplot.acomp(xc_ordered)
         
```

Possibly drop copper and nickel


```{r}
dd <-
  read.table(text = content(GET("https://gist.githubusercontent.com/MrFlick/c1183c911bc5398105d4/raw/715868fba2d0d17a61a8081de17c468bbc525ab1/elements.txt")),
  sep = ",",
  header = TRUE) %>%
  mutate(
    ElementName = ifelse(ElementName == "Sulfer", "Sulfur", ElementName),
    ElementName = ifelse(ElementName == "Phosphorous", "Phosphorus", ElementName),
    ElementName = ifelse(ElementName == "Flourine", "Fluorine", ElementName))

data <- read_excel("melting_points.xlsx", sheet = 2)

colnames(dd) <- c(colnames(dd)[1:7], "element", colnames(dd)[9:13])

data <- dd %>% 
  left_join(data, by = "element")


head(dd)
dd %>%
  left_join(data, by = "element", ) %>%
  ggplot(aes(Column.x,-Row.x)) +
  geom_tile(aes(fill = crystal_structure), color = "black") +
  geom_text(aes(label = symbol)) +
  theme_void() +
  labs(fill = "Crystal Structure") +
  annotate(
    "text",
    x = 7,
    y = 0.2,
    label = "Periodic Table of the elements",
    size = 5)

dd %>%
  left_join(data, by = "element") %>%
  mutate(
    log_cte = log(CTE),
    new_cte = CTE * 1000000,
    is_extreme = ifelse(new_cte < 10, 0, 1)
  ) %>%
  ggplot(aes(Column.x,-Row.x)) +
  geom_tile(aes(fill = log10(CTE)), color = "black", size = 1) +
  geom_text(aes(label = symbol), colour = "black") +
  geom_text(aes(label = new_cte), colour = "black", nudge_y = -0.3) +
  scale_fill_gradient(low = "red", high = "green") +
  theme_void() +
  labs(fill = expression(paste("CTE", 10 ^ 6))) +
  annotate(
    "text",
    x = 7,
    y = 0.2,
    label = "Periodic Table of the elements",
    size = 5)


```



```{r}

f1 <- function(x){
  return(1/(16.6*3*(x+273)))
}


library(plotly)
library(ggrepel)
data %>% 
  ggplot(aes(mp, CTE, label=element))+
  geom_point()+
  stat_function(fun=f1)+
  lims(
    x=c(1500,4000),
    y=c(0,0.000025)
  )+
  theme(legend.position = "none")+
  ggrepel::geom_text_repel()+
  theme_classic()
library(broom)
augment(lm(CTE ~ mp, data = data)) %>%
  ggplot(aes(mp,CTE))+
  geom_point()+
  geom_point(aes(mp, .fitted), colour= "blue")+
  theme_classic()



```

